##### 1.è‡ªå¢ï¼š

![image-20210902184601801](images/image-20210902184601801.png)



##### 2.å…³äº==è¿ç®—ç¬¦

![image-20211012103356205](images/image-20211012103356205.png)

##### 3.é‡è½½å’Œé‡å†™

![image-20211014104609400](images/image-20211014104609400.png)

##### 4.åˆå§‹åŒ–

![image-20211014110516856](images/image-20211014110516856.png)

##### 5.Java8æ–°ç‰¹æ€§ ç€é‡çœ‹ä¸‹æ–¹æ³•å¼•ç”¨

![image-20211014163551227](images/image-20211014163551227.png)



##### 6.hashcode

![image-20211015150926091](images/image-20211015150926091.png)

å…³äºhashCodeå’Œequalsæ–¹æ³•é‡å†™çš„æ–‡ç« ï¼šhttps://www.cnblogs.com/skywang12345/p/3324958.html

##### 7.åŸºæœ¬æ•°æ®ç±»å‹

charç±»å‹å’Œæ•°å­—æ¯”è¾ƒ å…¶å®æ˜¯åŒascIIç æ¯”è¾ƒã€‚ascllç çš„åè¿›åˆ¶æ•°å­—èŒƒå›´

##### 8.Javaæ˜¯å€¼ä¼ é€’ã€‚

å¦‚æœå‚æ•°æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ­¤æ—¶å®å‚èµ‹ç»™å½¢å‚çš„æ˜¯å®å‚çœŸå®å­˜å‚¨çš„æ•°æ®å€¼
å¦‚æœå‚æ•°æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ­¤æ—¶å®å‚èµ‹ç»™å½¢å‚çš„æ˜¯å®å‚å­˜å‚¨æ•°æ®çš„åœ°å€å€¼

https://www.bilibili.com/video/BV1Qb411g7cz?p=211

å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’çš„åŒºåˆ«æ˜¯å¼•ç”¨ä¼ é€’ä¸ä¼šåˆ›å»ºå‰¯æœ¬ï¼Œå€¼ä¼ é€’ä¼šåˆ›å»ºå‰¯æœ¬
![image-20211018100209774](images/image-20211018100209774.png)



##### 9.javaå˜é‡å­˜å‚¨

**æ–¹æ³•ä½“ä¸­**çš„å¼•ç”¨å˜é‡å’ŒåŸºæœ¬ç±»å‹çš„å˜é‡éƒ½åœ¨æ ˆä¸Šï¼Œå…¶ä»–éƒ½åœ¨å †ä¸Š(å¯¹è±¡)

Javaæˆå‘˜å˜é‡çš„å¼•ç”¨åœ¨å †é‡Œï¼›å¦‚æœæˆå‘˜å˜é‡æ˜¯å€¼ç±»å‹ï¼Œé‚£ä¹ˆå€¼ä¹Ÿåœ¨å †é‡Œã€‚è¯¦æƒ…çœ‹ä¸‹è™šæ‹Ÿæœºæ ˆçš„ç»“æ„
![image-20211018105556962](images/image-20211018105556962.png)

###### å…³äºJavaæ–¹æ³•ä¸­å˜é‡çš„å­˜å‚¨ä½ç½®

https://www.cnblogs.com/bky-nll/p/11117603.html

Javaä¸­çš„å˜é‡æ ¹æ®ä¸åŒçš„æ ‡å‡†å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä»¥å…¶å¼•ç”¨çš„æ•°æ®ç±»å‹çš„ä¸åŒæ¥åˆ’åˆ†å¯åˆ†ä¸ºâ€œåŸå§‹æ•°æ®ç±»å‹å˜é‡å’Œå¼•ç”¨æ•°æ®ç±»å‹å˜é‡â€ï¼Œä»¥å…¶ä½œç”¨èŒƒå›´çš„ä¸åŒæ¥åŒºåˆ†å¯åˆ†ä¸ºâ€œå±€éƒ¨å˜é‡ï¼Œå®ä¾‹å˜é‡å’Œé™æ€å˜é‡â€ã€‚

æ ¹æ®â€œ[Javaä¸­çš„å˜é‡ä¸æ•°æ®ç±»å‹](https://blog.csdn.net/leunging/article/details/80598259)â€ä¸­çš„ä»‹ç»ï¼Œâ€œå˜é‡æ˜¯åœ¨å†…å­˜ä¸­åˆ†é…çš„ä¿ç•™åŒºåŸŸçš„åç§°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…å­˜ä½ç½®çš„åç§°â€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå˜é‡åå­—å°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå˜é‡æ‰€å¼•ç”¨çš„æ•°æ®çš„å†…å­˜æŒ‡é’ˆï¼Œæ ¹æ®å˜é‡çš„ç±»å‹æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸ªæŒ‡é’ˆä¹‹åçš„å‡ ä¸ªå­—èŠ‚é‡Œå­˜å‚¨äº†è¿™ä¸ªå˜é‡æ‰€å¼•ç”¨çš„æ•°æ®ã€‚

æ‰€ä»¥ï¼Œäº†è§£å˜é‡åœ¨æ–¹æ³•åŒºã€æ ˆå†…å­˜ã€å †å†…å­˜ä¸­çš„åˆ†é…è¦äº†è§£ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œä¸€ä¸ªæ˜¯â€œå˜é‡åœ¨å†…å­˜ä¸­çš„åˆ†é…â€ï¼Œå¦ä¸€ä¸ªæ˜¯â€œå˜é‡æ‰€å¼•ç”¨çš„æ•°æ®åœ¨å†…å­˜ä¸­çš„åˆ†é…â€ã€‚ä»¥ä¸‹ç®€ç§°ä¸ºâ€œå˜é‡åˆ†é…â€ä¸â€œæ•°æ®åˆ†é…â€ã€‚

**åŸå§‹æ•°æ®ç±»å‹å˜é‡ï¼š**
**åŸå§‹æ•°æ®ç±»å‹å˜é‡çš„â€œå˜é‡åˆ†é…â€ä¸â€œæ•°æ®åˆ†é…â€æ˜¯åœ¨ä¸€èµ·çš„ï¼ˆéƒ½åœ¨æ–¹æ³•åŒºæˆ–æ ˆå†…å­˜æˆ–å †å†…å­˜ï¼‰**

**å¼•ç”¨æ•°æ®ç±»å‹å˜é‡ï¼š**
**å¼•ç”¨æ•°æ®ç±»å‹å˜é‡çš„â€œå˜é‡åˆ†é…â€ä¸â€œæ•°æ®åˆ†é…â€ä¸ä¸€å®šæ˜¯åœ¨ä¸€èµ·çš„ã€‚**

ç¤ºä¾‹ä»£ç 

```java
class Fruit {
    static int x = 10;
    static BigWaterMelon bigWaterMelon_1 = new BigWaterMelon(x);

    int y = 20;
    BigWaterMelon bigWaterMelon_2 = new BigWaterMelon(y);
    
    public static void main(String[] args) {
        final Fruit fruit = new Fruit();
    
        int z = 30;
        BigWaterMelon bigWaterMelon_3 = new BigWaterMelon(z);
    
        new Thread() {
            @Override
            public void run() {
                int k = 100;
                setWeight(k);
            }
    
            void setWeight(int waterMelonWeight) {
                fruit.bigWaterMelon_2.weight = waterMelonWeight;
            }
        }.start();
    }

}

class BigWaterMelon {
    public BigWaterMelon(int weight) {
        this.weight = weight;
    }

    public int weight;

}
```

![img](images/1262880-20190701233921618-1915183516.png)

åŒä¸€ç§é¢œè‰²ä»£è¡¨å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼š

ç”±äºæ–¹æ³•åŒºå’Œå †å†…å­˜çš„æ•°æ®éƒ½æ˜¯çº¿ç¨‹é—´å…±äº«çš„ï¼Œæ‰€ä»¥çº¿ç¨‹Main Threadï¼ŒNew Threadå’ŒAnother Threadéƒ½å¯ä»¥è®¿é—®æ–¹æ³•åŒºä¸­çš„é™æ€å˜é‡ä»¥åŠè®¿é—®è¿™ä¸ªå˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å®ä¾‹å˜é‡ã€‚psï¼šæ–¹æ³•åŒºå­˜å‚¨çš„éƒ½æ˜¯åªåŠ è½½ä¸€æ¬¡çš„ã€‚

**å…³äºç”¨finalä¿®é¥°çš„å˜é‡**

åŸºæœ¬ç±»å‹ï¼šåŸºæœ¬ç±»å‹çš„å€¼ä¸èƒ½å‘ç”Ÿæ”¹å˜
å¼•ç”¨ç±»å‹ï¼šå¼•ç”¨ç±»å‹çš„åœ°å€å€¼ä¸èƒ½å‘ç”Ÿæ”¹å˜ã€‚ä½†æ˜¯ï¼Œè¯¥å¯¹è±¡çš„å †å†…å­˜çš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚

##### 10.try-catch-finallyæ‰§è¡Œé¡ºåº

a. finally çš„åŸºç¡€ç”¨æ³•ï¼Œåœ¨ return å‰ä¼šå…ˆæ‰§è¡Œ finally è¯­å¥å—ï¼Œæ‰€ä»¥æ˜¯å…ˆè¾“å‡º finally é‡Œçš„ 3ï¼Œå†è¾“å‡º return çš„ 1ï¼Œæ‰§è¡Œç»“æœï¼š31

```java
public class TryDemo {
    public static void main(String[] args) {
        System.out.println(test());
    }
    public static int test() {
        try {
            return 1;
        } catch (Exception e) {
            return 2;
        } finally {
            System.out.print("3");
        }
    }
}
```

b. æ‰§è¡Œç»“æœï¼š3ã€‚try è¿”å›å‰å…ˆæ‰§è¡Œ finallyï¼Œç»“æœ finally é‡Œä¸æŒ‰å¥—è·¯å‡ºç‰Œï¼Œç›´æ¥ return äº†ï¼Œè‡ªç„¶ä¹Ÿå°±èµ°ä¸åˆ° try é‡Œé¢çš„ return äº†ã€‚

```java
public class TryDemo {
    public static void main(String[] args) {
        System.out.println(test1());
    }
    public static int test1() {
        try {
            return 2;
        } finally {
            return 3;
        }
    }
}
```

c.æ‰§è¡Œç»“æœï¼š2ã€‚åœ¨æ‰§è¡Œ finally ä¹‹å‰ï¼ŒJVM ä¼šå…ˆå°† i çš„ç»“æœæš‚å­˜èµ·æ¥ï¼Œç„¶å finally æ‰§è¡Œå®Œæ¯•åï¼Œä¼šè¿”å›ä¹‹å‰æš‚å­˜çš„ç»“æœï¼Œè€Œä¸æ˜¯è¿”å› iï¼Œæ‰€ä»¥å³ä½¿è¿™è¾¹ i å·²ç»è¢«ä¿®æ”¹ä¸º 3ï¼Œæœ€ç»ˆè¿”å›çš„è¿˜æ˜¯ä¹‹å‰æš‚å­˜èµ·æ¥çš„ç»“æœ 2ã€‚è¿™è¾¹å…¶å®æ ¹æ®å­—èŠ‚ç å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œåœ¨è¿›å…¥ finally ä¹‹å‰ï¼ŒJVM ä¼šä½¿ç”¨ iloadã€istore ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå°†ç»“æœæš‚å­˜ï¼Œåœ¨æœ€ç»ˆè¿”å›æ—¶åœ¨é€šè¿‡ iloadã€ireturn æŒ‡ä»¤è¿”å›æš‚å­˜çš„ç»“æœ

```java
public class TryDemo {
    public static void main(String[] args) {
        System.out.println(test1());
    }
    public static int test1() {
        int i = 0;
        try {
            i = 2;
            return i;
        } finally {
            i = 3;
        }
    }
}
```

##### 11.ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œä»€ä¹ˆæ˜¯ååºåˆ—åŒ–

- **åºåˆ—åŒ–**ï¼š å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹
- **ååºåˆ—åŒ–**ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹

å¯¹äºä¸æƒ³è¿›è¡Œåºåˆ—åŒ–çš„å˜é‡ï¼Œä½¿ç”¨ `transient` å…³é”®å­—ä¿®é¥°ã€‚

`transient` å…³é”®å­—çš„ä½œç”¨æ˜¯ï¼šé˜»æ­¢å®ä¾‹ä¸­é‚£äº›ç”¨æ­¤å…³é”®å­—ä¿®é¥°çš„çš„å˜é‡åºåˆ—åŒ–ï¼›å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢« `transient` ä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ã€‚

å…³äº `transient` è¿˜æœ‰å‡ ç‚¹æ³¨æ„ï¼š

- `transient` åªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•ã€‚
- `transient` ä¿®é¥°çš„å˜é‡ï¼Œåœ¨ååºåˆ—åŒ–åå˜é‡å€¼å°†ä¼šè¢«ç½®æˆç±»å‹çš„é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ˜¯ä¿®é¥° `int` ç±»å‹ï¼Œé‚£ä¹ˆååºåˆ—åç»“æœå°±æ˜¯ `0`ã€‚
- `static` å˜é‡å› ä¸ºä¸å±äºä»»ä½•å¯¹è±¡(Object)ï¼Œæ‰€ä»¥æ— è®ºæœ‰æ²¡æœ‰ `transient` å…³é”®å­—ä¿®é¥°ï¼Œå‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚

##### 12.Java IOæµ

- æŒ‰ç…§æµçš„æµå‘åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµï¼›

- æŒ‰ç…§æ“ä½œå•å…ƒåˆ’åˆ†ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼›

- æŒ‰ç…§æµçš„è§’è‰²åˆ’åˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚

  æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?

  é—®é¢˜æœ¬è´¨æƒ³é—®ï¼š**ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ**

  å›ç­”ï¼šå­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯éå¸¸è€—æ—¶ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ I/O æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚

##### 13.staticå…³é”®å­—

**static å…³é”®å­—ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ä½¿ç”¨åœºæ™¯ï¼š**

a.**ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•:** è¢« static ä¿®é¥°çš„æˆå‘˜å±äºç±»ï¼Œä¸å±äºå•ä¸ªè¿™ä¸ªç±»çš„æŸä¸ªå¯¹è±¡ï¼Œè¢«ç±»ä¸­æ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œå¯ä»¥å¹¶ä¸”å»ºè®®é€šè¿‡ç±»åè°ƒç”¨ã€‚è¢« static å£°æ˜çš„æˆå‘˜å˜é‡å±äºé™æ€æˆå‘˜å˜é‡ï¼Œé™æ€å˜é‡ å­˜æ”¾åœ¨ Java å†…å­˜åŒºåŸŸçš„æ–¹æ³•åŒºã€‚è°ƒç”¨æ ¼å¼ï¼š`ç±»å.é™æ€å˜é‡å` `ç±»å.é™æ€æ–¹æ³•å()`

b.**é™æ€ä»£ç å—:** é™æ€ä»£ç å—å®šä¹‰åœ¨ç±»ä¸­æ–¹æ³•å¤–, é™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œ(é™æ€ä»£ç å—â€”>éé™æ€ä»£ç å—â€”>æ„é€ æ–¹æ³•)ã€‚ è¯¥ç±»ä¸ç®¡åˆ›å»ºå¤šå°‘å¯¹è±¡ï¼Œé™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡.
static{}`é™æ€ä»£ç å—ä¸`{}éé™æ€ä»£ç å—(æ„é€ ä»£ç å—)

ç›¸åŒç‚¹ï¼š éƒ½æ˜¯åœ¨ JVM åŠ è½½ç±»æ—¶ä¸”åœ¨æ„é€ æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œåœ¨ç±»ä¸­éƒ½å¯ä»¥å®šä¹‰å¤šä¸ªï¼Œå®šä¹‰å¤šä¸ªæ—¶æŒ‰å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œä¸€èˆ¬åœ¨ä»£ç å—ä¸­å¯¹ä¸€äº› static å˜é‡è¿›è¡Œèµ‹å€¼ã€‚

ä¸åŒç‚¹ï¼š é™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œ(é™æ€ä»£ç å— -> éé™æ€ä»£ç å— -> æ„é€ æ–¹æ³•)ã€‚é™æ€ä»£ç å—åªåœ¨ç¬¬ä¸€æ¬¡ new æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¸å†æ‰§è¡Œï¼Œè€Œéé™æ€ä»£ç å—åœ¨æ¯ new ä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡ã€‚ éé™æ€ä»£ç å—å¯åœ¨æ™®é€šæ–¹æ³•ä¸­å®šä¹‰(ä¸è¿‡ä½œç”¨ä¸å¤§)ï¼›è€Œé™æ€ä»£ç å—ä¸è¡Œã€‚

> **ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š [issue #677](https://github.com/Snailclimb/JavaGuide/issues/677)ï¼‰** ï¼šé™æ€ä»£ç å—å¯èƒ½åœ¨ç¬¬ä¸€æ¬¡ new å¯¹è±¡çš„æ—¶å€™æ‰§è¡Œï¼Œä½†ä¸ä¸€å®šåªåœ¨ç¬¬ä¸€æ¬¡ new çš„æ—¶å€™æ‰§è¡Œã€‚æ¯”å¦‚é€šè¿‡ `Class.forName("ClassDemo")`åˆ›å»º Class å¯¹è±¡çš„æ—¶å€™ä¹Ÿä¼šæ‰§è¡Œï¼Œå³ new æˆ–è€… `Class.forName("ClassDemo")` éƒ½ä¼šæ‰§è¡Œé™æ€ä»£ç å—ã€‚

éé™æ€ä»£ç å—ä¸æ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ï¼š éé™æ€ä»£ç å—æ˜¯ç»™æ‰€æœ‰å¯¹è±¡è¿›è¡Œç»Ÿä¸€åˆå§‹åŒ–ï¼Œè€Œæ„é€ å‡½æ•°æ˜¯ç»™å¯¹åº”çš„å¯¹è±¡åˆå§‹åŒ–ï¼Œå› ä¸ºæ„é€ å‡½æ•°æ˜¯å¯ä»¥å¤šä¸ªçš„ï¼Œè¿è¡Œå“ªä¸ªæ„é€ å‡½æ•°å°±ä¼šå»ºç«‹ä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Œä½†æ— è®ºå»ºç«‹å“ªä¸ªå¯¹è±¡ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œç›¸åŒçš„æ„é€ ä»£ç å—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ„é€ ä»£ç å—ä¸­å®šä¹‰çš„æ˜¯ä¸åŒå¯¹è±¡å…±æ€§çš„åˆå§‹åŒ–å†…å®¹ã€‚

c.**é™æ€å†…éƒ¨ç±»ï¼ˆstatic ä¿®é¥°ç±»çš„è¯åªèƒ½ä¿®é¥°å†…éƒ¨ç±»ï¼‰ï¼š** é™æ€å†…éƒ¨ç±»ä¸éé™æ€å†…éƒ¨ç±»ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«: éé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´ç±»ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚æ²¡æœ‰è¿™ä¸ªå¼•ç”¨å°±æ„å‘³ç€ï¼š1. å®ƒçš„åˆ›å»ºæ˜¯ä¸éœ€è¦ä¾èµ–å¤–å›´ç±»çš„åˆ›å»ºã€‚2. å®ƒä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–å›´ç±»çš„é static æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚

**Exampleï¼ˆé™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼ï¼‰**

```java
public class Singleton {

    //å£°æ˜ä¸º private é¿å…è°ƒç”¨é»˜è®¤æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡
    private Singleton() {
    }

   // å£°æ˜ä¸º private è¡¨æ˜é™æ€å†…éƒ¨è¯¥ç±»åªèƒ½åœ¨è¯¥ Singleton ç±»ä¸­è¢«è®¿é—®
    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getUniqueInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```

å½“ Singleton ç±»åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±» SingletonHolder æ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ã€‚åªæœ‰å½“è°ƒç”¨ `getUniqueInstance()`æ–¹æ³•ä»è€Œè§¦å‘ `SingletonHolder.INSTANCE` æ—¶ SingletonHolder æ‰ä¼šè¢«åŠ è½½ï¼Œæ­¤æ—¶åˆå§‹åŒ– INSTANCE å®ä¾‹ï¼Œå¹¶ä¸” JVM èƒ½ç¡®ä¿ INSTANCE åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚

è¿™ç§æ–¹å¼ä¸ä»…å…·æœ‰å»¶è¿Ÿåˆå§‹åŒ–çš„å¥½å¤„ï¼Œè€Œä¸”ç”± JVM æä¾›äº†å¯¹çº¿ç¨‹å®‰å…¨çš„æ”¯æŒã€‚

d.**é™æ€å¯¼åŒ…(ç”¨æ¥å¯¼å…¥ç±»ä¸­çš„é™æ€èµ„æºï¼Œ1.5 ä¹‹åçš„æ–°ç‰¹æ€§):** æ ¼å¼ä¸ºï¼š`import static` è¿™ä¸¤ä¸ªå…³é”®å­—è¿ç”¨å¯ä»¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„æŒ‡å®šé™æ€èµ„æºï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ç±»åè°ƒç”¨ç±»ä¸­é™æ€æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚

##### 14.this å…³é”®å­—

this å…³é”®å­—ç”¨äºå¼•ç”¨ç±»çš„å½“å‰å®ä¾‹ã€‚ ä¾‹å¦‚ï¼š

```java
class Manager {
    Employees[] employees;

    void manageEmployees() {
        int totalEmp = this.employees.length;
        System.out.println("Total employees: " + totalEmp);
        this.report();
    }

    void report() { }
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œthis å…³é”®å­—ç”¨äºä¸¤ä¸ªåœ°æ–¹ï¼š

- this.employees.lengthï¼šè®¿é—®ç±» Manager çš„å½“å‰å®ä¾‹çš„å˜é‡ã€‚
- this.reportï¼ˆï¼‰ï¼šè°ƒç”¨ç±» Manager çš„å½“å‰å®ä¾‹çš„æ–¹æ³•ã€‚

æ­¤å…³é”®å­—æ˜¯å¯é€‰çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸Šé¢çš„ç¤ºä¾‹åœ¨ä¸ä½¿ç”¨æ­¤å…³é”®å­—çš„æƒ…å†µä¸‹è¡¨ç°ç›¸åŒã€‚ ä½†æ˜¯ï¼Œä½¿ç”¨æ­¤å…³é”®å­—å¯èƒ½ä¼šä½¿ä»£ç æ›´æ˜“è¯»æˆ–æ˜“æ‡‚ã€‚

##### 15.super å…³é”®å­—

super å…³é”®å­—ç”¨äºä»å­ç±»è®¿é—®çˆ¶ç±»çš„å˜é‡å’Œæ–¹æ³•ã€‚ ä¾‹å¦‚ï¼š

```java
public class Super {
    protected int number;

    protected showNumber() {
        System.out.println("number = " + number);
    }
}

public class Sub extends Super {
    void bar() {
        super.number = 10;
        super.showNumber();
    }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒSub ç±»è®¿é—®çˆ¶ç±»æˆå‘˜å˜é‡ number å¹¶è°ƒç”¨å…¶çˆ¶ç±» Super çš„ `showNumberï¼ˆï¼‰` æ–¹æ³•ã€‚

**ä½¿ç”¨ this å’Œ super è¦æ³¨æ„çš„é—®é¢˜ï¼š**

- åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨ `super()` è°ƒç”¨çˆ¶ç±»ä¸­çš„å…¶ä»–æ„é€ æ–¹æ³•æ—¶ï¼Œè¯¥è¯­å¥å¿…é¡»å¤„äºæ„é€ å™¨çš„é¦–è¡Œï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚å¦å¤–ï¼Œthis è°ƒç”¨æœ¬ç±»ä¸­çš„å…¶ä»–æ„é€ æ–¹æ³•æ—¶ï¼Œä¹Ÿè¦æ”¾åœ¨é¦–è¡Œã€‚
- thisã€super ä¸èƒ½ç”¨åœ¨ static æ–¹æ³•ä¸­ã€‚

**ç®€å•è§£é‡Šä¸€ä¸‹ï¼š**

è¢« static ä¿®é¥°çš„æˆå‘˜å±äºç±»ï¼Œä¸å±äºå•ä¸ªè¿™ä¸ªç±»çš„æŸä¸ªå¯¹è±¡ï¼Œè¢«ç±»ä¸­æ‰€æœ‰å¯¹è±¡å…±äº«ã€‚è€Œ this ä»£è¡¨å¯¹æœ¬ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œ**æŒ‡å‘æœ¬ç±»å¯¹è±¡**ï¼›è€Œ super ä»£è¡¨å¯¹çˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨ï¼ŒæŒ‡å‘çˆ¶ç±»å¯¹è±¡ï¼›æ‰€ä»¥ï¼Œ **this å’Œ super æ˜¯å±äºå¯¹è±¡èŒƒç•´çš„ä¸œè¥¿ï¼Œè€Œé™æ€æ–¹æ³•æ˜¯å±äºç±»èŒƒç•´çš„ä¸œè¥¿**

##### 16.åå°„

**ä¼˜ç‚¹** ï¼š å¯ä»¥è®©å’±ä»¬çš„ä»£ç æ›´åŠ çµæ´»ã€ä¸ºå„ç§æ¡†æ¶æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½æä¾›äº†ä¾¿åˆ©

**ç¼ºç‚¹** ï¼šè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶æœ‰äº†åˆ†ææ“ä½œç±»çš„èƒ½åŠ›ï¼Œè¿™åŒæ ·ä¹Ÿå¢åŠ äº†å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚å¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼‰ã€‚å¦å¤–ï¼Œåå°„çš„æ€§èƒ½ä¹Ÿè¦ç¨å·®ç‚¹ï¼Œä¸è¿‡ï¼Œå¯¹äºæ¡†æ¶æ¥è¯´å®é™…æ˜¯å½±å“ä¸å¤§çš„ã€‚

##### 17.åŠ¨æ€ä»£ç†

a.JDKåŠ¨æ€ä»£ç†ï¼š

åœ¨JDK åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ `InvocationHandler` æ¥å£å’Œ `Proxy` ç±»æ˜¯æ ¸å¿ƒ
JDK åŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªæœ€è‡´å‘½çš„é—®é¢˜æ˜¯å…¶åªèƒ½**ä»£ç†å®ç°äº†æ¥å£çš„ç±»**

b.CGLIBåŠ¨æ€ä»£ç†ï¼š

åœ¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ `MethodInterceptor` æ¥å£å’Œ `Enhancer` ç±»æ˜¯æ ¸å¿ƒ

Spring ä¸­çš„ AOP æ¨¡å—ä¸­ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™é‡‡ç”¨ CGLIB åŠ¨æ€ä»£ç†

###### JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å¯¹æ¯”

1. **JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚** å¦å¤–ï¼Œ CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä»£ç†å£°æ˜ä¸º final ç±»å‹çš„ç±»å’Œæ–¹æ³•ã€‚
2. å°±äºŒè€…çš„æ•ˆç‡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ JDK åŠ¨æ€ä»£ç†æ›´ä¼˜ç§€ï¼Œéšç€ JDK ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™ä¸ªä¼˜åŠ¿æ›´åŠ æ˜æ˜¾

###### é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯”

1. **çµæ´»æ€§** ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼
2. **JVM å±‚é¢** ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚

##### 18.æ•°ç»„

javaæ•°ç»„ä¸­çš„lengthæ˜¯åœ¨å“ªä¸ªç±»é‡Œå®šä¹‰çš„ï¼Ÿ
æ•°ç»„æ˜¯åœ¨Javaä¸­çš„ç‰¹æ®Šå¯¹è±¡ï¼Œä»–ä»¬æœ‰ä¸€ä¸ªåä¸ºä¸€ä¸ªç®€å•çš„å±æ€§`length`æ˜¯`final`ã€‚æ²¡æœ‰æ•°ç»„çš„â€œç±»å®šä¹‰â€ï¼ˆä½ æ— æ³•åœ¨ä»»ä½•.classæ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒï¼‰ï¼Œå®ƒä»¬æ˜¯è¯­è¨€æœ¬èº«çš„ä¸€éƒ¨åˆ†

##### 19.é›†åˆ

TreeMapï¼Œ

###### a.javaé›†åˆç±»å›¾

![image-20211025160936034](images/image-20211025160936034.png)

###### b.ArrayListå’ŒVectorçš„åŒºåˆ«

- `ArrayList` æ˜¯ `List` çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ `Object[ ]`å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ ï¼›
- `Vector` æ˜¯ `List` çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨`Object[ ]` å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚

###### c.HashMapæ‰©å®¹

JDK1.8 ä¹‹ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰
1.å¦‚æœå½“å‰é•¿åº¦å°äº64åˆ™è¿›è¡Œæ‰©å®¹

ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´

###### d.HashMapåœ¨jdk8çš„åº•å±‚å®ç°

![img](images/b2aebd46ed8d41111825cd15ac2a3be6.png)

1.new HashMap()ï¼šåº•å±‚æ²¡æœ‰åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º16çš„æ•°ç»„

2.jdk8åº•å±‚çš„æ•°ç»„æ˜¯Node[]

3.é¦–æ¬¡è°ƒç”¨putæ–¹æ³•æ—¶ï¼Œåº•å±‚åˆ›å»ºé•¿åº¦ä¸º16çš„æ•°ç»„

4.åº•å±‚æ•°æ®ç»“æ„ï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘

* å½¢æˆé“¾è¡¨æ—¶ï¼Œæ—§çš„å…ƒç´ æŒ‡å‘æ–°çš„å…ƒç´ ï¼›jdk7æ˜¯æ–°çš„å…ƒç´ æŒ‡å‘æ—§çš„å…ƒç´ 

* å½“æ•°ç»„çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®ä¸Šçš„å…ƒç´ **ä»¥é“¾è¡¨å½¢å¼å­˜åœ¨çš„æ•°æ®ä¸ªæ•°>8** ä¸”**å½“å‰æ•°ç»„çš„é•¿åº¦>64**æ—¶ï¼Œæ­¤æ—¶**æ­¤ç´¢å¼•**ä½ç½®ä¸Šçš„æ‰€æœ‰æ•°æ®æ”¹ä¸ºçº¢é»‘æ ‘å­˜å‚¨

  HashMapåº•å±‚ä¸€äº›é‡è¦å¸¸é‡ï¼š

  ```
  /*
   *      DEFAULT_INITIAL_CAPACITY : HashMapçš„é»˜è®¤å®¹é‡ï¼Œ16
   *      DEFAULT_LOAD_FACTORï¼šHashMapçš„é»˜è®¤åŠ è½½å› å­ï¼š0.75
   *      thresholdï¼šæ‰©å®¹çš„ä¸´ç•Œå€¼ï¼Œ=å®¹é‡*å¡«å……å› å­ï¼š16 * 0.75 => 12
   *      TREEIFY_THRESHOLDï¼šBucketä¸­é“¾è¡¨é•¿åº¦å¤§äºè¯¥é»˜è®¤å€¼ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘:8
   *      MIN_TREEIFY_CAPACITYï¼šæ¡¶ä¸­çš„Nodeè¢«æ ‘åŒ–æ—¶æœ€å°çš„hashè¡¨å®¹é‡:64
   */
  ```

  å…³äº**åŠ è½½å› å­**
  ![image-20211202152320380](images/image-20211202152320380.png)

###### e.LinkedHashMapçš„åº•å±‚å®ç°åŸç†ï¼ˆäº†è§£ï¼‰

* LinkedHashMap`æ˜¯`HashMapçš„å­ç±»

* åœ¨HashMapå­˜å‚¨ç»“æ„çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨äº†ä¸€å¯¹åŒå‘é“¾è¡¨æ¥è®°å½•æ·»åŠ å…ƒç´ çš„é¡ºåº

* ä¸`LinkedHashSet`ç±»ä¼¼ï¼Œ`LinkedHashMap`å¯ä»¥ç»´æŠ¤`Map` çš„è¿­ä»£é¡ºåºï¼šè¿­ä»£é¡ºåºä¸`Key-Value` å¯¹çš„æ’å…¥é¡ºåºä¸€è‡´

* HashMap`ä¸­çš„å†…éƒ¨ç±»ï¼š`Node

  ![img](images/342cf58820c14e037baaadd31c600d80.png)

* LinkedHashMap`ä¸­çš„å†…éƒ¨ç±»ï¼š`Entry

  ![img](images/edbc291a09efb65428640308c90d7b8b.png)

###### f.HashSetåº•å±‚æ˜¯ä»€ä¹ˆï¼Ÿ

åº•å±‚æ˜¯HashMapï¼Œkeyæ˜¯å…·ä½“çš„å€¼ï¼Œvalueæ˜¯objectç±»å‹å¸¸é‡

###### g.TreeMap (todo) è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åº

###### h.Propertiesï¼ˆtodoï¼‰

##### 20.å¯¹è±¡çš„è®¿é—®å®šä½

**å¥æŸ„ï¼š** å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆJavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼› 

**ç›´æ¥æŒ‡é’ˆï¼š** å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚

![image-20211110112734059](images/image-20211110112734059.png)

##### 21.çº¿ç¨‹çš„å¸¸ç”¨æ–¹æ³•

ä»€ä¹ˆå«**çº¿ç¨‹é˜»å¡**ï¼šåœ¨æŸä¸€æ—¶åˆ»æŸä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œä¸€æ®µä»£ç çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿéœ€è¦è¿è¡Œï¼Œä½†æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ˜¯æ— æ³•è·å–åˆ°CPUæ‰§è¡Œæƒçš„ã€‚

ä¸ºä»€ä¹ˆä¼šå‡ºç°çº¿ç¨‹é˜»å¡ï¼Ÿ

###### 1.ç¡çœ çŠ¶æ€ï¼š

å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»£ç çš„æ—¶å€™è°ƒç”¨äº†sleepæ–¹æ³•åï¼Œçº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªç¡çœ æ—¶é—´ï¼Œæ­¤æ—¶æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦æ‰§è¡Œæ—¶å°±ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œè€Œä¸”sleepæ–¹æ³•è¢«è°ƒç”¨ä¹‹åï¼Œçº¿ç¨‹**ä¸ä¼šé‡Šæ”¾é”å¯¹è±¡**ï¼Œä½†æ˜¯é”è¿˜åœ¨è¯¥çº¿ç¨‹æ‰‹é‡Œ,ç­‰ç¡çœ ä¸€æ®µæ—¶é—´åï¼Œè¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€

###### 2.ç­‰å¾…çŠ¶æ€ï¼š

å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨äº†waitæ–¹æ³•ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹éœ€è¦äº¤å‡ºCPUæ‰§è¡Œæƒï¼Œä¹Ÿå°±æ˜¯å°†é”**é‡Šæ”¾**å‡ºå»ï¼Œäº¤ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä½†ä¸ç¡çœ çŠ¶æ€ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹**ä¸éœ€è¦è®¾ç½®ç¡çœ æ—¶é—´**ï¼Œä½†æ˜¯**éœ€è¦æ‰§è¡Œnotifyæ–¹æ³•æˆ–è€…notifyallæ–¹æ³•æ¥å¯¹å…¶å”¤é†’**ï¼Œè‡ªå·±æ˜¯ä¸ä¼šä¸»åŠ¨é†’æ¥çš„ï¼Œç­‰è¢«å”¤é†’ä¹‹åï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¿›å…¥**å°±ç»ª**çŠ¶æ€ï¼Œä½†æ˜¯è¿™æ—¶è¿›å…¥å°±ç»ªçŠ¶æ€çš„è¯¥çº¿ç¨‹æ‰‹é‡Œæ˜¯**æ²¡æœ‰æ‰§è¡Œæƒ**çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é”ï¼Œè€Œç¡çœ çŠ¶æ€çš„çº¿ç¨‹ä¸€æ—¦è‹é†’ï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€æ—¶æ˜¯è‡ªå·±è¿˜æ‹¿ç€é”çš„ã€‚ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è‹é†’åï¼Œå°±æ˜¯å…¸å‹çš„â€œç‰©æ˜¯äººéï¼Œå¤§æƒæ—è½â€œï¼›

###### 3.ç¤¼è®©çŠ¶æ€ï¼š

å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨äº†yieldæ–¹æ³•ä¹‹åï¼Œè¯¥çº¿ç¨‹ä¼šå°†**æ‰§è¡Œæƒ**ç¤¼è®©ç»™**åŒç­‰çº§çš„çº¿ç¨‹æˆ–è€…æ¯”å®ƒé«˜ä¸€çº§çš„çº¿ç¨‹ä¼˜å…ˆæ‰§è¡Œ**ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹æœ‰å¯èƒ½åªæ‰§è¡Œäº†ä¸€éƒ¨åˆ†è€Œæ­¤æ—¶æŠŠæ‰§è¡Œæƒç¤¼è®©ç»™äº†å…¶ä»–çº¿ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™ä¹Ÿä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä½†æ˜¯è¯¥çº¿ç¨‹ä¼šéšæ—¶å¯èƒ½åˆè¢«åˆ†é…åˆ°æ‰§è¡Œæƒï¼Œè¿™å°±å¾ˆâ€ä¸­å›½åŒ–çš„çº¿ç¨‹â€œäº†ï¼Œæ¯”è¾ƒè®²ç©¶è°¦è®©ï¼›

Threadé‡Œçš„yieldæ–¹æ³•çš„ä½œç”¨

è®©å½“å‰å¤„äº`è¿è¡ŒçŠ¶æ€`çš„çº¿ç¨‹é€€å›åˆ°`å¯è¿è¡ŒçŠ¶æ€`ï¼Œè®©å‡ºæŠ¢å èµ„æºçš„æœºä¼š

https://blog.csdn.net/weixin_43553694/article/details/104107493

![image-20211108155237541](images/image-20211108155237541.png)

è¿™é‡Œçš„Thread.yield()æ˜¯ä¸»çº¿ç¨‹é€€åˆ°æœ€åˆä½ç½®ï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œã€‚>2çš„åŸå› æ˜¯javaé»˜è®¤ä¸¤ä¸ªçº¿ç¨‹mainå’Œgcçº¿ç¨‹ã€‚

###### 4.è‡ªé—­çŠ¶æ€ï¼štodo:

å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨äº†ä¸€ä¸ªjoinæ–¹æ³•ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¼šè¿è¡Œï¼Œç›´åˆ°è¿è¡Œç»“æŸåï¼ŒåŸçº¿ç¨‹æ‰ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚è¿™ä¸ªæ¯”è¾ƒåƒæ˜¯â€èµ°åé—¨â€œï¼Œæœ¬æ¥è¯¥å…ˆæŠŠä½ çš„äº‹æƒ…è§£å†³å®Œäº†å†è§£å†³åè¾¹çš„äººçš„äº‹æƒ…ï¼Œä½†æ˜¯è¿™æ—¶å€™æœ‰èµ°åé—¨çš„äººï¼Œé‚£å°±ä¼šåœæ­¢ç»™ä½ è§£å†³ï¼Œè€Œä¼˜å…ˆæŠŠèµ°åé—¨çš„äººäº‹æƒ…è§£å†³äº†ï¼›

###### 5.suspend() å’Œ resume() ï¼š

è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œsuspend() æ˜¯è®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå®ƒçš„è§£è¯å°±æ˜¯resume()ï¼Œæ²¡æœ‰resume()å®ƒè‡ªå·±æ˜¯ä¸ä¼šæ¢å¤çš„ï¼Œç”±äºè¿™ç§æ¯”è¾ƒå®¹æ˜“å‡ºç°æ­»é”ç°è±¡ï¼Œæ‰€ä»¥jdk1.5ä¹‹åå°±å·²ç»è¢«åºŸé™¤äº†ï¼Œè¿™å¯¹å°±æ˜¯ç›¸çˆ±ç›¸æ€çš„ä¸€å¯¹ã€‚



```
 Threadç±»é‡Œçš„å¸¸ç”¨æ–¹æ³•
 * 1. start():å¯åŠ¨å½“å‰çº¿ç¨‹ï¼›è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
 * 2. run(): é€šå¸¸éœ€è¦é‡å†™Threadç±»ä¸­çš„æ­¤æ–¹æ³•ï¼Œå°†åˆ›å»ºçš„çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨æ­¤æ–¹æ³•ä¸­
 * 3. currentThread():é™æ€æ–¹æ³•ï¼Œè¿”å›æ‰§è¡Œå½“å‰ä»£ç çš„çº¿ç¨‹
 * 4. getName():è·å–å½“å‰çº¿ç¨‹çš„åå­—
 * 5. setName():è®¾ç½®å½“å‰çº¿ç¨‹çš„åå­—
 * 6. yield():é‡Šæ”¾å½“å‰cpuçš„æ‰§è¡Œæƒ
 * 7. join():åœ¨çº¿ç¨‹aä¸­è°ƒç”¨çº¿ç¨‹bçš„join(),æ­¤æ—¶çº¿ç¨‹aå°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹bå®Œå…¨æ‰§è¡Œå®Œä»¥åï¼Œçº¿ç¨‹aæ‰
 * ç»“æŸé˜»å¡çŠ¶æ€ã€‚
 * 8. stop():å·²è¿‡æ—¶ã€‚å½“æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå¼ºåˆ¶ç»“æŸå½“å‰çº¿ç¨‹ã€‚
 * 9. sleep(long millitime):è®©å½“å‰çº¿ç¨‹â€œç¡çœ â€æŒ‡å®šçš„millitimeæ¯«ç§’ã€‚åœ¨æŒ‡å®šçš„millitimeæ¯«ç§’æ—¶é—´å†…ï¼Œå½“å‰
 * çº¿ç¨‹æ˜¯é˜»å¡çŠ¶æ€ã€‚
 * 10. isAlive():åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å­˜æ´»
 
  çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼š
 * 1.
 * MAX_PRIORITYï¼š10
 * MIN _PRIORITYï¼š1
 * NORM_PRIORITYï¼š5  -->é»˜è®¤ä¼˜å…ˆçº§
 * 2.å¦‚ä½•è·å–å’Œè®¾ç½®å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼š
 * getPriority():è·å–çº¿ç¨‹çš„ä¼˜å…ˆçº§
 * setPriority(int p):è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§
    *
 * è¯´æ˜ï¼šé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹è¦æŠ¢å ä½ä¼˜å…ˆçº§çº¿ç¨‹cpuçš„æ‰§è¡Œæƒã€‚ä½†æ˜¯åªæ˜¯ä»æ¦‚ç‡ä¸Šè®²ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹é«˜æ¦‚ç‡çš„æƒ…å†µä¸‹
 * è¢«æ‰§è¡Œã€‚å¹¶ä¸æ„å‘³ç€åªæœ‰å½“é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰§è¡Œå®Œä»¥åï¼Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰æ‰§è¡Œã€‚
```



##### 22.çº¿ç¨‹å®‰å…¨é—®é¢˜

```
ä¸€ã€ åŒæ­¥ä»£ç å—è§£å†³
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ .ä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼
   *
 * 1.é—®é¢˜ï¼šå–ç¥¨è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é‡ç¥¨ã€é”™ç¥¨ -->å‡ºç°äº†çº¿ç¨‹çš„å®‰å…¨é—®é¢˜
 * 2.é—®é¢˜å‡ºç°çš„åŸå› ï¼šå½“æŸä¸ªçº¿ç¨‹æ“ä½œè½¦ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œå°šæœªæ“ä½œå®Œæˆæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å‚ä¸è¿›æ¥ï¼Œä¹Ÿæ“ä½œè½¦ç¥¨ã€‚
 * 3.å¦‚ä½•è§£å†³ï¼šå½“ä¸€ä¸ªçº¿ç¨‹aåœ¨æ“ä½œticketçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å‚ä¸è¿›æ¥ã€‚ç›´åˆ°çº¿ç¨‹aæ“ä½œå®Œticketæ—¶ï¼Œå…¶ä»–
 * çº¿ç¨‹æ‰å¯ä»¥å¼€å§‹æ“ä½œticketã€‚è¿™ç§æƒ…å†µå³ä½¿çº¿ç¨‹aå‡ºç°äº†é˜»å¡ï¼Œä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚
    *
    *
 * 4.åœ¨Javaä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åŒæ­¥æœºåˆ¶ï¼Œæ¥è§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ã€‚
   *
 * æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—
   *
 * synchronized(åŒæ­¥ç›‘è§†å™¨){
 * //éœ€è¦è¢«åŒæ­¥çš„ä»£ç 
    *
 * }
 * è¯´æ˜ï¼š1.æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ï¼Œå³ä¸ºéœ€è¦è¢«åŒæ­¥çš„ä»£ç ã€‚  -->ä¸èƒ½åŒ…å«ä»£ç å¤šäº†ï¼Œä¹Ÿä¸èƒ½åŒ…å«ä»£ç å°‘äº†ã€‚
 * 2.å…±äº«æ•°æ®ï¼šå¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œçš„å˜é‡ã€‚æ¯”å¦‚ï¼šticketå°±æ˜¯å…±äº«æ•°æ®ã€‚
 * 3.åŒæ­¥ç›‘è§†å™¨ï¼Œä¿—ç§°ï¼šé”ã€‚ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥å……å½“é”ã€‚
 * è¦æ±‚ï¼šå¤šä¸ªçº¿ç¨‹å¿…é¡»è¦å…±ç”¨åŒä¸€æŠŠé”ã€‚
    *
 * è¡¥å……ï¼šåœ¨å®ç°Runnableæ¥å£åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨thiså……å½“åŒæ­¥ç›‘è§†å™¨ã€‚
 * æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•ã€‚
 * å¦‚æœæ“ä½œå…±äº«æ•°æ®çš„ä»£ç å®Œæ•´çš„å£°æ˜åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸å¦¨å°†æ­¤æ–¹æ³•å£°æ˜åŒæ­¥çš„ã€‚
    *
    *
 * 5.åŒæ­¥çš„æ–¹å¼ï¼Œè§£å†³äº†çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ã€‚---å¥½å¤„
 * æ“ä½œåŒæ­¥ä»£ç æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„è¿‡ç¨‹ï¼Œæ•ˆç‡ä½ã€‚ ---å±€é™æ€§

 * ä½¿ç”¨åŒæ­¥ä»£ç å—è§£å†³ç»§æ‰¿Threadç±»çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
   *
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ .ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼
   *
 * è¯´æ˜ï¼šåœ¨ç»§æ‰¿Threadç±»åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸­ï¼Œæ…ç”¨thiså……å½“åŒæ­¥ç›‘è§†å™¨ï¼Œè€ƒè™‘ä½¿ç”¨å½“å‰ç±»å……å½“åŒæ­¥ç›‘è§†å™¨ã€‚

1ã€ä½¿ç”¨ç»§æ‰¿Threadçš„æ–¹å¼

	é‡è¦: ä½¿ç”¨Window.clssä½œä¸ºåŒæ­¥é”, åŸå› : å› ä¸ºæˆ‘ä»¬æ¯ä¸€ä¸ªthiséƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡, å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªçª—å£, æ‰€ä»¥å¦‚æœè¦ä½¿ç”¨Window.clssæ¥å……å½“å”¯ä¸€çš„é”;

public class Windows extends Thread {
	private static int ticket = 100; // å¤šä¸ªThreadå¯¹è±¡è¦å…±äº«ticketç¥¨

	// private static Object obj = new Object(); // éœ€è¦åŠ static, å› ä¸ºåŒæ­¥ç›‘è§†å™¨è¦æ˜¯å”¯ä¸€çš„
	@Override
	public void run() {
	    while (true) {
	        // synchronized (obj) { // æ­£ç¡®
	        // synchronized (this) { // é”™è¯¯çš„æ–¹å¼,ä½¿ç”¨ç»§æ‰¿æ¥åˆ›å»ºthread,å› ä¸ºthisä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡,ä¸èƒ½å……å½“å…±äº«èµ„æºçš„åŒæ­¥é”
	        synchronized (Window.class) { // ç±»å¯¹è±¡,åªä¼šåŠ è½½ä¸€æ¬¡,æ‰€ä»¥ä¹Ÿæ˜¯å”¯ä¸€çš„
	            if (ticket > 0) {
	                try {
	                    Thread.sleep(100);
	                } catch (InterruptedException e) {
	                    e.printStackTrace();
	                }
	                System.out.println(Thread.currentThread().getName() + ": å–ç¥¨, ç¥¨å·ä¸º: " + ticket);
	                ticket--;
	            } else {
	                break;
	            }
	        }
	    }
	}

}
public class WindowsTest2 {
    public static void main(String[] args) {
        Windows t1 = new Windows();
        Windows t2 = new Windows();
        Windows t3 = new Windows();

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");
    
        t1.start();
        t2.start();
        t3.start();
    }

}

2ã€ä½¿ç”¨å®ç°Runnableæ–¹å¼

é‡ç‚¹: å› ä¸ºåªåˆ›å»ºäº†ä¸€ä¸ªWindowå¯¹è±¡, æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥å…±äº«è¯¥å¯¹è±¡, æ‰€ä»¥ä½¿ç”¨this,å……å½“åŒæ­¥é”
public class Windows1 implements Runnable {
	private int ticket = 100;

    @Override
    public void run() {
        while (true) {
        	// ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥å……å½“å…¶ åŒæ­¥ç›‘è§†å™¨, å› ä¸ºå§‹ç»ˆåˆ›å»ºäº†ä¸€ä¸ªå®ç°Rnnableæ¥å£çš„å®ä¾‹;
            synchronized (this) {
                if (ticket > 0) {
                    try {
                        Thread.sleep(50);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(Thread.currentThread().getName() + "å–ç¥¨,ç¥¨å·ä¸º: " + ticket);
                    ticket--;
                } else {
                    break;
                }
            }
        }
    }

 }
public class WindowsTest1 {
    public static void main(String[] args) {
        Windows1 w = new Windows1();

        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);
    
        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");
    
        t1.start();
        t2.start();
        t3.start();
    }

}
äºŒã€åŒæ­¥æ–¹æ³•æ¥è§£å†³

é‡ç‚¹: 

 * ä½¿ç”¨åŒæ­¥æ–¹æ³•è§£å†³å®ç°Runnableæ¥å£çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
   *
 * å…³äºåŒæ­¥æ–¹æ³•çš„æ€»ç»“ï¼š
 * 1. åŒæ­¥æ–¹æ³•ä»ç„¶æ¶‰åŠåˆ°åŒæ­¥ç›‘è§†å™¨ï¼Œåªæ˜¯ä¸éœ€è¦æˆ‘ä»¬æ˜¾å¼çš„å£°æ˜ã€‚
 * 2. éé™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šthis
 * é™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šå½“å‰ç±»æœ¬èº«


é‡ç‚¹:
åœ¨synchronizedå‰é¢åŠ ä¸Šstatic, å¦‚æœæ˜¯é™æ€çš„åŒæ­¥æ–¹æ³•, æ‰€æœ‰çš„å¯¹è±¡éƒ½å…±äº«; ç›¸å½“äº Xxx.classçš„æ–¹å¼

1ã€é€šè¿‡ç»§æ‰¿Threadæ¥å®ç°çº¿ç¨‹åŒæ­¥:
	// private synchronized void show () { // æ­¤æ—¶åŒæ­¥é”ä¸æ˜¯å”¯ä¸€çš„äº†.
    private static synchronized void show () { // é”å°±æ˜¯ å½“å‰ç±»å¯¹è±¡, Xxx.class
        if (ticket > 0) {
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + ": å–ç¥¨, ç¥¨å·ä¸º: " + ticket);
            ticket--;
        }
    }
    
é‡ç‚¹:
åªéœ€è¦åŠ ä¸Šsynchronized, å› ä¸ºåªåˆ›å»ºä¸€ä¸ªwindowå¯¹è±¡, æ‰€ä»¥ä¸éœ€è¦åŠ static, ç›¸å½“äºthis

2ã€é€šè¿‡å®ç°Runnableæ¥å£æ¥åˆ›å»ºçº¿ç¨‹:
    private synchronized void show() {  // åŒæ­¥ç›‘è§†å™¨(åŒæ­¥é”) å°±æ˜¯ this
        if (ticket > 0) {
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + "å–ç¥¨,ç¥¨å·ä¸º: " + ticket);
            ticket--;
        }
    }

ä¸‰ã€ è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹å¼ä¸‰ï¼šLocké”  --- JDK5.0æ–°å¢
 *

 * 1. é¢è¯•é¢˜ï¼šsynchronized ä¸ Lockçš„å¼‚åŒï¼Ÿ
 * ç›¸åŒï¼šäºŒè€…éƒ½å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜
 * ä¸åŒï¼šsynchronizedæœºåˆ¶åœ¨æ‰§è¡Œå®Œç›¸åº”çš„åŒæ­¥ä»£ç ä»¥åï¼Œè‡ªåŠ¨çš„é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨
 * Lockéœ€è¦æ‰‹åŠ¨çš„å¯åŠ¨åŒæ­¥ï¼ˆlock()ï¼‰ï¼ŒåŒæ—¶ç»“æŸåŒæ­¥ä¹Ÿéœ€è¦æ‰‹åŠ¨çš„å®ç°ï¼ˆunlock()ï¼‰
    *
 * 2.ä¼˜å…ˆä½¿ç”¨é¡ºåºï¼š
 * Lock -> åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æºï¼‰-> åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“ä¹‹å¤–ï¼‰
   *
    *
 * é¢è¯•é¢˜ï¼šå¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿæœ‰å‡ ç§æ–¹å¼
```



##### 23.çº¿ç¨‹é—´é€šä¿¡é—®é¢˜

```
çº¿ç¨‹é€šä¿¡çš„ä¾‹å­ï¼šä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ‰“å° 1-100ã€‚çº¿ç¨‹1, çº¿ç¨‹2 äº¤æ›¿æ‰“å°
 *

 * æ¶‰åŠåˆ°çš„ä¸‰ä¸ªæ–¹æ³•ï¼š
 * wait():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨(é”)ã€‚
 * notify():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’è¢«waitçš„ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¢«waitï¼Œå°±å”¤é†’ä¼˜å…ˆçº§é«˜çš„é‚£ä¸ªã€‚
 * notifyAll():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’æ‰€æœ‰è¢«waitçš„çº¿ç¨‹ã€‚
   *
 * è¯´æ˜ï¼š
 * 1.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ã€‚
 * 2.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¯åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­çš„åŒæ­¥ç›‘è§†å™¨ã€‚
 * å¦åˆ™ï¼Œä¼šå‡ºç°IllegalMonitorStateExceptionå¼‚å¸¸
 * 3.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨java.lang.Objectç±»ä¸­ã€‚
   *
 * é¢è¯•é¢˜ï¼šsleep() å’Œ wait()çš„å¼‚åŒï¼Ÿ
 * 1.ç›¸åŒç‚¹ï¼šä¸€æ—¦æ‰§è¡Œæ–¹æ³•ï¼Œéƒ½å¯ä»¥ä½¿å¾—å½“å‰çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚
 * 2.ä¸åŒç‚¹ï¼š1ï¼‰ä¸¤ä¸ªæ–¹æ³•å£°æ˜çš„ä½ç½®ä¸åŒï¼šThreadç±»ä¸­å£°æ˜sleep() , Objectç±»ä¸­å£°æ˜wait()
 * 2ï¼‰è°ƒç”¨çš„è¦æ±‚ä¸åŒï¼šsleep()å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœºæ™¯ä¸‹è°ƒç”¨ã€‚ wait()å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­
 * 3ï¼‰å…³äºæ˜¯å¦é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ï¼šå¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œsleep()ä¸ä¼šé‡Šæ”¾é”ï¼Œwait()ä¼šé‡Šæ”¾é”ã€‚

class Thread1 implements Runnable {

    private int number = 1;
    
    @Override
    public void run() {
        while (true) {
            synchronized (this) {
                this.notify(); // å”¤é†’è¢«wait()çš„çº¿ç¨‹
                if (number <= 100) {
                    try {
                        Thread.sleep(50);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(Thread.currentThread().getName() + ": number" + number);
                    number++;
                    try {
                        // è°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹,è¿›å…¥é˜»å¡çŠ¶æ€
                        this.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                } else {
                    break;
                }
            }
        }
    }

}
```



##### 24.transientå…³é”®å­—å’ŒSerializableæ¥å£

##### 25.é˜»å¡é˜Ÿåˆ—

å½“é˜»å¡é˜Ÿåˆ—æ˜¯ç©ºæ—¶ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡ã€‚
å½“é˜»å¡é˜Ÿåˆ—æ˜¯æ»¡æ—¶ï¼Œå¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡ã€‚

##### 26.CountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphore

##### 27.å¤šçº¿ç¨‹ä¸‹çš„è™šå‡å”¤é†’

https://www.icode9.com/content-4-792471.html

waitï¼šæ­¤æ–¹æ³•å‡ºè‡ªObjectç±»ï¼Œæ‰€æœ‰å¯¹è±¡å‡å¯è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå®ƒçš„åº”ç”¨ä¸»è¦æ˜¯è·Ÿå‡ºèº«è‡ªThreadç±»çš„sleepæ–¹æ³•ä½œæ¯”è¾ƒã€‚
sleep:ï¼šæ–¹æ³•è¯´ç™½äº†å°±æ˜¯è¿«ä½¿å½“å‰çº¿ç¨‹æ‹¿ç€é”ç¡çœ æŒ‡å®šæ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°æ‰‹é‡Œæ‹¿ç€é”è‡ªåŠ¨é†’æ¥ï¼Œè¿˜å¯ä»¥å¾€ä¸‹ç»§ç»­æ‰§è¡Œã€‚
waitæ–¹æ³•æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€ä¸ªå¸¦å‚æ•°æŒ‡å®šç¡çœ æ—¶é—´ï¼ˆæˆ‘ä»¬ä¸è®¨è®ºè¿™ç§å®ç°ï¼‰ï¼Œä¸€ä¸ªä¸å¸¦å‚æ•°æŒ‡å®šæ— é™ç¡çœ ï¼Œè¿™ä¸¤ç§æ–¹å¼å‡å¯è¿«ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç¡çœ 
ã€€ã€€çŠ¶æ€ï¼Œä½†æ˜¯ä¸åŒäºsleepï¼Œwaitæ˜¯**é‡Šæ”¾é”**å»ç¡çš„ï¼Œåªæœ‰å½“å‰é”å¯¹è±¡è°ƒç”¨äº†**notifyæˆ–è€…notifyAll**æ–¹æ³•æ‰ä¼šé†’æ¥ï¼Œä½†æ‰‹é‡Œæ˜¯**æ²¡æœ‰é”**çš„ï¼Œ
ã€€ã€€ç›¸å¯¹åº”å°±æ²¡æœ‰äº†**ç«‹å³æ‰§è¡Œä¸‹å»çš„æƒåˆ©**ï¼Œè€Œæ˜¯**è¿›å…¥äº†å°±ç»ªçŠ¶æ€**ï¼Œéšæ—¶å‡†å¤‡ä¸å…¶ä»–çº¿ç¨‹è¿›è¡Œäº‰æŠ¢CPUçš„æ‰§è¡Œæƒã€‚è€Œä¸”waitæ–¹æ³•ä¸€èˆ¬æƒ…å†µæ˜¯é…åˆsyncä½¿ç”¨çš„ã€‚

æ‰€ä»¥å½“åŒæ­¥æ–¹æ³•å†…çš„æ–¹æ³•ç”¨çš„ifè¿›è¡Œåˆ¤æ–­çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š

```
1ã€AæŠ¢åˆ°é”æ‰§è¡Œ ++                    0 
2ã€Aæ‰§è¡Œnotifyå‘ç°æ²¡æœ‰äººwaitï¼Œç»§ç»­æ‹¿ç€é”æ‰§è¡Œ ï¼ŒAåˆ¤æ–­ä¸é€šè¿‡ï¼ŒAé˜»å¡    1
3ã€BæŠ¢åˆ°é” ï¼ŒBåˆ¤æ–­ä¸é€šè¿‡ï¼ŒBé˜»å¡   ã€€ã€€ã€€1
4ã€C æŠ¢åˆ°é” æ‰§è¡Œ--     ã€€          ã€€0
5ã€C æ‰§è¡ŒNotify å”¤é†’Aï¼Œ Aæ‰§è¡Œ++      1
6ã€A æ‰§è¡Œnotifyå”¤é†’B ï¼ŒBæ‰§è¡Œ++       2  ï¼ˆæ³¨æ„è¿™ä¸ªåœ°æ–¹æ°å·§å”¤é†’Bï¼Œé‚£ä¹ˆB ä»å“ªé˜»å¡çš„å°±ä»å“ªå”¤é†’ï¼ŒBç»§ç»­æ‰§è¡Œwaitä¸‹é¢çš„++æ“ä½œï¼Œå¯¼è‡´å‡ºç°2ï¼‰
å†å¤šä¸€äº›è§£é‡Šï¼šé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°-2ï¼Œ-3ï¼Œå› ä¸ºæˆ‘ä»¬çš„å‡æ³•åˆ¤æ–­æ˜¯ ==0çš„æ—¶å€™æ‰é˜»å¡ï¼Œä¸€æ—¦ä¸º-1ï¼Œå°±ä¼šä¸ºfalseï¼Œå†æ¬¡æ‰§è¡Œ--æ“ä½œï¼›
çœ‹å®Œä¸Šé¢çš„æ­¥éª¤åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä¸¤å¤§é—®é¢˜ï¼š
1ã€ç¬¬6æ­¥å”¤é†’äº†Bæ˜¯æå¤§çš„é”™è¯¯ï¼Œå› ä¸ºBçš„é†’æ¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬éœ€è¦çš„Cæˆ–è€…Dé†’æ¥ï¼Œè¿™å°±æ˜¯æœ¬æ–‡é¢˜ç›®æ‰€è¯´çš„è™šå‡å”¤é†’ï¼Œ
æˆ‘ä»¬å°±è¦åƒä¸ªåŠæ³•ï¼Œè¿‡æ»¤æ‰Bï¼›
2ã€æƒ³çš„æ·±å…¥çš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œä¸Šé¢ä»£ç æœ¬åº”æœ‰20æ­¥ï¼Œä¸ºä»€ä¹ˆåˆ°äº†17æ­¥åœæ­¢äº†ï¼Œè¿™å°±æ˜¯å”¤é†’ä¸å½“ï¼Œæ‰€æœ‰çº¿ç¨‹å‡è¢«ç½®ä¸ºé˜»å¡çŠ¶æ€
```

whileæ˜¯ä¸ºäº†å†ä¸€æ¬¡å¾ªç¯åˆ¤æ–­**åˆšåˆšäº‰æŠ¢åˆ°é”çš„çº¿ç¨‹æ˜¯å¦æ»¡è¶³ç»§ç»­æ‰§è¡Œä¸‹å»çš„æ¡ä»¶**ï¼Œæ¡ä»¶é€šè¿‡æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œä¸é€šè¿‡çš„çº¿ç¨‹åªèƒ½å†æ¬¡è¿›å…¥waitçŠ¶æ€ï¼Œç”±å…¶ä»–æ´»ç€çš„ã€å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è¿›è¡Œäº‰æŠ¢é”ã€‚

```java
package jucdemo;

public class TraditionalProducerConsumerDemo {

    public static void main(String[] args) {
        Data data = new Data();
        //ç”Ÿäº§è€…çº¿ç¨‹A
        new Thread(() -> {
            for (int i = 0;i < 5;i++) {
                try {
                    data.increment();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        },"A").start();

        //ç”Ÿäº§è€…çº¿ç¨‹B
        new Thread(() -> {
            for (int i = 0;i < 5;i++) {
                try {
                    data.increment();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        },"B").start();

        //æ¶ˆè´¹è€…çº¿ç¨‹C
        new Thread(() -> {
            for (int i = 0;i < 5;i++) {
                try {
                    data.decrement();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        },"C").start();

        //æ¶ˆè´¹è€…çº¿ç¨‹D
        new Thread(() -> {
            for (int i = 0;i < 5;i++) {
                try {
                    data.decrement();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        },"D").start();
    }



    //æ•°æ®ç±»
    static class Data {
        //è¡¨ç¤ºæ•°æ®ä¸ªæ•°
        private int number = 0;

        public synchronized void increment() throws InterruptedException {
            //å…³é”®ç‚¹ï¼Œè¿™é‡Œåº”è¯¥ä½¿ç”¨whileå¾ªç¯
            while (number != 0) {
                this.wait();
            }
            number++;
            System.out.println(Thread.currentThread().getName() + "ç”Ÿäº§äº†æ•°æ®:" + number);
            this.notifyAll();
        }

        public synchronized void decrement() throws InterruptedException {
            //å…³é”®ç‚¹ï¼Œè¿™é‡Œåº”è¯¥ä½¿ç”¨whileå¾ªç¯
            while (number == 0) {
                this.wait();
            }
            number--;
            System.out.println(Thread.currentThread().getName() + "æ¶ˆè´¹äº†æ•°æ®:" + number);
            this.notifyAll();
        }
    }
}
```



##### 28.synchronizedå’Œlockçš„åŒºåˆ«

1.synchronizedå±äºJVMå±‚é¢ï¼Œå±äºjavaçš„å…³é”®å­—
monitorenterï¼ˆåº•å±‚æ˜¯é€šè¿‡monitorå¯¹è±¡æ¥å®Œæˆï¼Œå…¶å®wait/notifyç­‰æ–¹æ³•ä¹Ÿä¾èµ–äºmonitorå¯¹è±¡ åªèƒ½åœ¨åŒæ­¥å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨ wait/ notifyç­‰æ–¹æ³•ï¼‰
Lockæ˜¯å…·ä½“ç±»ï¼ˆjava.util.concurrent.locks.Lockï¼‰æ˜¯apiå±‚é¢çš„é”

2.ä½¿ç”¨æ–¹æ³•ï¼š
synchronizedï¼šä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedä»£ç æ‰§è¡Œåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ã€‚
ReentrantLockï¼šåˆ™éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œè‹¥æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æ­»é”çš„ç°è±¡ï¼Œéœ€è¦lock() å’Œ unlock() é…ç½®try catchè¯­å¥æ¥å®Œæˆ

3.ç­‰å¾…æ˜¯å¦ä¸­æ–­
synchronizedï¼šä¸å¯ä¸­æ–­ï¼Œé™¤éæŠ›å‡ºå¼‚å¸¸æˆ–è€…æ­£å¸¸è¿è¡Œå®Œæˆã€‚
ReentrantLockï¼šå¯ä¸­æ–­ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶æ–¹æ³•
è®¾ç½®è¶…æ—¶æ–¹æ³•ï¼Œtrylock(long timeout, TimeUnit unit)
lockInterrupible() æ”¾ä»£ç å—ä¸­ï¼Œè°ƒç”¨interrupt() æ–¹æ³•å¯ä»¥ä¸­æ–­

4.åŠ é”æ˜¯å¦å…¬å¹³
synchronizedï¼šéå…¬å¹³é”
ReentrantLockï¼šé»˜è®¤éå…¬å¹³é”ï¼Œæ„é€ å‡½æ•°å¯ä»¥ä¼ é€’booleanå€¼ï¼Œtrueä¸ºå…¬å¹³é”ï¼Œfalseä¸ºéå…¬å¹³é”

5.é”ç»‘å®šå¤šä¸ªæ¡ä»¶Condition
synchronizedï¼šæ²¡æœ‰ï¼Œè¦ä¹ˆéšæœºï¼Œè¦ä¹ˆå…¨éƒ¨å”¤é†’
ReentrantLockï¼šç”¨æ¥å®ç°åˆ†ç»„å”¤é†’éœ€è¦å”¤é†’çš„çº¿ç¨‹ï¼Œå¯ä»¥ç²¾ç¡®å”¤é†’ï¼Œè€Œä¸æ˜¯åƒsynchronizedé‚£æ ·ï¼Œè¦ä¹ˆéšæœºï¼Œè¦ä¹ˆå…¨éƒ¨å”¤é†’(notifyå’ŒnotifyAll)

##### 29.synchronizedå’Œlocké”ä¿è¯å¯è§æ€§

å¯è§æ€§ä½“ç°åœ¨ï¼šé€šè¿‡synchronizedæˆ–è€…Lockèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰**ä¸€ä¸ªçº¿ç¨‹**è·å–é”ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”åœ¨**é‡Šæ”¾é”ä¹‹å‰ä¼šå°†å¯¹å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å­˜ä¸­**ã€‚

##### 30.å¼ºè½¯å¼±è™šå¼•ç”¨æ¶æ„å›¾

![image-20211119163720130](images/image-20211119163720130.png)

##### 31.å¼ºå¼•ç”¨

å¼ºå¼•ç”¨æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œåªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜â€œæ´»ç€â€ï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šç¢°è¿™ç§å¯¹è±¡ã€‚åœ¨Javaä¸­æœ€å¸¸è§çš„å°±æ˜¯å¼ºå¼•ç”¨ï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨å˜é‡å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼ºå¼•ç”¨å˜é‡å¼•ç”¨æ—¶ï¼Œå®ƒå¤„äºå¯è¾¾çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸å¯èƒ½è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶çš„ï¼Œå³ä½¿è¯¥å¯¹è±¡ä»¥åæ°¸è¿œéƒ½ä¸ä¼šè¢«ç”¨åˆ°ï¼ŒJVMä¹Ÿä¸ä¼šå›æ”¶ã€‚å› æ­¤å¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚

å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦**è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸ**æˆ–è€…**æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸º null**ä¸€èˆ¬è®¤ä¸ºå°±æ˜¯å¯ä»¥è¢«åƒåœ¾æ”¶é›†çš„äº†(å½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥)

```java
public static void main(String[] args) throws Exception {
    String str1 = new String("11223344");
    String str2 = str1;
    str1 = null;
    System.gc();
    System.out.println(str2);
    System.out.println(str1);
}
```

str1ç½®ä¸ºç©ºçš„æ—¶å€™ ï¼Œç»è¿‡åƒåœ¾åå›æ”¶å‘ç°str2ä¸ä¼šä¸ºç©ºï¼ŒéªŒè¯äº†
åªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜â€œæ´»ç€â€ï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šç¢°è¿™ç§å¯¹è±¡ã€‚

##### 32.è½¯å¼•ç”¨

è½¯å¼•ç”¨æ˜¯ä¸€ç§ç›¸å¯¹å¼ºå¼•ç”¨å¼±åŒ–äº†ä¸€äº›çš„å¼•ç”¨ï¼Œéœ€è¦ç”¨java.lang.ref.SoftReferenceç±»æ¥å®ç°ï¼Œå¯ä»¥è®©å¯¹è±¡è±å…ä¸€äº›åƒåœ¾æ”¶é›†ã€‚

å¯¹äºåªæœ‰è½¯å¼•ç”¨çš„å¯¹è±¡æ¥è¯´

* å½“ç³»ç»Ÿå†…å­˜å……è¶³æ—¶å®ƒä¸ä¼šè¢«å›æ”¶ï¼Œ
* å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶å®ƒä¼šè¢«å›æ”¶ã€‚

è½¯å¼•ç”¨é€šå¸¸ç”¨åœ¨å¯¹å†…å­˜æ•æ„Ÿçš„ç¨‹åºä¸­ï¼Œæ¯”å¦‚é«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ï¼Œ**å†…å­˜å¤Ÿç”¨çš„æ—¶å€™å°±ä¿ç•™ï¼Œä¸å¤Ÿç”¨å°±å›æ”¶!**

```java
public class SoftReferenceDemo {

    /**
     * å†…å­˜å¤Ÿç”¨çš„æ—¶å€™
     * -XX:+PrintGCDetails
     */
    public static void softRefMemoryEnough() {
        // åˆ›å»ºä¸€ä¸ªå¼ºåº”ç”¨
        Object o1 = new Object();
        // åˆ›å»ºä¸€ä¸ªè½¯å¼•ç”¨
        SoftReference<Object> softReference = new SoftReference<>(o1);
        System.out.println(o1);
        System.out.println(softReference.get());
    
        o1 = null;
        // æ‰‹åŠ¨GC
        System.gc();
    
        System.out.println(o1);
        System.out.println(softReference.get());
    }
    
    /**
     * JVMé…ç½®ï¼Œæ•…æ„äº§ç”Ÿå¤§å¯¹è±¡å¹¶é…ç½®å°çš„å†…å­˜ï¼Œè®©å®ƒçš„å†…å­˜ä¸å¤Ÿç”¨äº†å¯¼è‡´OOMï¼Œçœ‹è½¯å¼•ç”¨çš„å›æ”¶æƒ…å†µ
     * -Xms5m -Xmx5m -XX:+PrintGCDetails
     */
    public static void softRefMemoryNoEnough() {
    
        System.out.println("========================");
        // åˆ›å»ºä¸€ä¸ªå¼ºåº”ç”¨
        Object o1 = new Object();
        // åˆ›å»ºä¸€ä¸ªè½¯å¼•ç”¨
        SoftReference<Object> softReference = new SoftReference<>(o1);
        System.out.println(o1);
        System.out.println(softReference.get());
    
        o1 = null;
    
        // æ¨¡æ‹ŸOOMè‡ªåŠ¨GC
        try {
            // åˆ›å»º30Mçš„å¤§å¯¹è±¡
            byte[] bytes = new byte[30 * 1024 * 1024];
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            System.out.println(o1);
            System.out.println(softReference.get());
        }
    }
    
    public static void main(String[] args) {
        softRefMemoryEnough();
        //softRefMemoryNoEnough();
    }
}
```



##### 33.å¼±å¼•ç”¨

å¼±å¼•ç”¨éœ€è¦ç”¨java.lang.ref.WeakReferenceç±»æ¥å®ç°ï¼Œå®ƒæ¯”è½¯å¼•ç”¨çš„ç”Ÿå­˜æœŸæ›´çŸ­ï¼Œ

å¯¹äºåªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œ**åªè¦åƒåœ¾å›æ”¶æœºåˆ¶**ä¸€è¿è¡Œä¸ç®¡JVMçš„å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶è¯¥å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚è¿™é‡Œçš„GCï¼Œæ˜¯**å¼±å¼•ç”¨ä¸­å…³è”çš„å¯¹è±¡**è¢«gcå›æ”¶ï¼Œé‚£ä¹ˆå¼±å¼•ç”¨ä¹Ÿä¸€å®šè¢«å›æ”¶

```java
public class WeakReferenceDemo {
    public static void main(String[] args) {
        Object o1 = new Object();
        WeakReference<Object> weakReference = new WeakReference<>(o1);
        System.out.println(o1);
        System.out.println(weakReference.get());
        o1 = null;
        System.gc();
        System.out.println(o1);
        System.out.println(weakReference.get());
    }
}
```

**ThreadLocal é‡Œæœ‰ç”¨åˆ°å¼±å¼•ç”¨**

##### 34.è½¯å¼•ç”¨é€‚ç”¨åœºæ™¯

åœºæ™¯ï¼šå‡å¦‚æœ‰ä¸€ä¸ªåº”ç”¨éœ€è¦è¯»å–å¤§é‡çš„æœ¬åœ°å›¾ç‰‡

* å¦‚æœæ¯æ¬¡è¯»å–å›¾ç‰‡éƒ½ä»ç¡¬ç›˜è¯»å–åˆ™ä¼šä¸¥é‡å½±å“æ€§èƒ½
* å¦‚æœä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåˆå¯èƒ½é€ æˆå†…å­˜æº¢å‡º

æ­¤æ—¶ä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è®¾è®¡æ€è·¯ï¼šä½¿ç”¨HashMapæ¥ä¿å­˜å›¾ç‰‡çš„è·¯å¾„å’Œç›¸åº”å›¾ç‰‡å¯¹è±¡å…³è”çš„è½¯å¼•ç”¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶è¿™äº›ç¼“å­˜å›¾ç‰‡å¯¹è±¡æ‰€å çš„ç©ºé—´ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº†OOMçš„é—®é¢˜ã€‚

```java
Map<String, SoftReference<Bitmap>> imageCache = new HashMap<String, SoftReference<Bitmap>>();
```

**mybatisæºç ä¸­å¤§é‡ç”¨åˆ°äº†è½¯å¼•ç”¨**

##### 35.å¼±å¼•ç”¨åº”ç”¨åœºæ™¯-WeakHashMap

```java
public static void main(String[] args) {
    myHashMap();
    System.out.println("==========");
    myWeakHashMap();
}

private static void myHashMap() {
    Map<Integer, String> map = new HashMap<>();
    Integer key = new Integer(1);
    String value = "HashMap";

    map.put(key, value);
    System.out.println(map);

    key = null;

    System.gc();

    System.out.println(map);
}

private static void myWeakHashMap() {
    Map<Integer, String> map = new WeakHashMap<>();
    Integer key = new Integer(1);
    String value = "WeakHashMap";

    map.put(key, value);
    System.out.println(map);

    key = null;

    System.gc();
    //è¿›è¡Œåƒåœ¾å›æ”¶å WeakHashMapé‡Œçš„æ¡ç›®ä¹Ÿè¢«å›æ”¶äº†
    System.out.println(map);
}
```

##### 36.è™šå¼•ç”¨ç®€ä»‹

è™šå¼•ç”¨éœ€è¦java.lang.ref.PhantomReferenceç±»æ¥å®ç°ã€‚

é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯**å½¢åŒè™šè®¾**ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚

å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±**å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·**ï¼Œ**åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶**ï¼Œå®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ä¹Ÿä¸èƒ½é€šè¿‡å®ƒè®¿é—®å¯¹è±¡ï¼Œ**è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—(ReferenceQueue)è”åˆä½¿ç”¨**ã€‚

è™šå¼•ç”¨çš„ä¸»è¦ä½œç”¨æ˜¯**è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€**ã€‚**ä»…ä»…æ˜¯æä¾›äº†ä¸€ç§ç¡®ä¿å¯¹è±¡è¢«finalizeä»¥åï¼ŒåšæŸäº›äº‹æƒ…çš„æœºåˆ¶**ã€‚

PhantomReferenceçš„**getæ–¹æ³•æ€»æ˜¯è¿”å›null**ï¼Œå› æ­¤æ— æ³•è®¿é—®å¯¹åº”çš„å¼•ç”¨å¯¹è±¡ã€‚å…¶æ„ä¹‰åœ¨äºè¯´æ˜ä¸€ä¸ªå¯¹è±¡å·²ç»è¿›å…¥finalizationé˜¶æ®µï¼Œå¯ä»¥è¢«gcå›æ”¶ï¼Œç”¨æ¥å®ç°æ¯”finalizationæœºåˆ¶æ›´çµæ´»çš„å›æ”¶æ“ä½œã€‚

æ¢å¥è¯è¯´ï¼Œè®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶çš„æ—¶å€™æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥æˆ–è€…åç»­æ·»åŠ è¿›ä¸€æ­¥çš„å¤„ç†ã€‚JavaæŠ€æœ¯å…è®¸ä½¿ç”¨finalize()æ–¹æ³•åœ¨åƒåœ¾æ”¶é›†å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­æ¸…é™¤å‡ºå»ä¹‹å‰åšå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚


##### 37.ReferenceQueueå¼•ç”¨é˜Ÿåˆ—

ç”¨**å¸¦æœ‰å¼•ç”¨é˜Ÿåˆ—**çš„å¼±(è½¯ï¼Œè™š)å¼•ç”¨**æ„é€ æ–¹æ³•**åˆå§‹åŒ–å¼•ç”¨å¯¹è±¡åï¼Œå›æ”¶å‰éœ€è¦è¢«å¼•ç”¨é˜Ÿåˆ—ä¿å­˜ä¸‹

```java
/**
 * å¼•ç”¨é˜Ÿåˆ—
 * æ‰§è¡Œgcå‰æ‰“å°çš„
 * java.lang.Object@4cc0edeb
 * java.lang.Object@4cc0edeb
 * null
 * å‘ç°å¼•ç”¨é˜Ÿåˆ—é‡Œæ²¡å†…å®¹
 * ====================================
 * æ‰§è¡Œgcåçš„æ‰“å°
 * null
 * null
 * java.lang.ref.WeakReference@e25b2fe
 * å‘ç°å¼•ç”¨é˜Ÿåˆ—é‡Œæœ‰å†…å®¹äº†ã€‚
 *
 * ç”¨å¸¦æœ‰å¼•ç”¨é˜Ÿåˆ—çš„å¼±(è½¯ï¼Œè™š)å¼•ç”¨æ„é€ æ–¹æ³•åˆå§‹åŒ–å¼•ç”¨å¯¹è±¡ï¼Œ
 * å› ä¸ºæ‰§è¡Œgcåï¼Œ
 * å›æ”¶å‰å¼•ç”¨é˜Ÿåˆ—é‡Œæ²¡æœ‰å†…å®¹ï¼Œå›æ”¶åçš„å¼±å¼•ç”¨ä¼šæ”¾åˆ°å¼•ç”¨é˜Ÿåˆ—é‡Œã€‚
 *
 * @author tc
 * @date 2021/11/22
 */
public class ReferenceQueueDemo {
    public static void main(String[] args) {
        Object o1 = new Object();

        // åˆ›å»ºå¼•ç”¨é˜Ÿåˆ—
        ReferenceQueue<Object> referenceQueue = new ReferenceQueue<>();

        // åˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨
        WeakReference<Object> weakReference = new WeakReference<>(o1, referenceQueue);

        System.out.println(o1);
        System.out.println(weakReference.get());
        // å–é˜Ÿåˆ—ä¸­çš„å†…å®¹
        System.out.println(referenceQueue.poll());

        System.out.println("==================");

        o1 = null;
        System.gc();
        System.out.println("æ‰§è¡ŒGCæ“ä½œ");

        try {
            TimeUnit.SECONDS.sleep(2);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println(o1);
        System.out.println(weakReference.get());
        // å–é˜Ÿåˆ—ä¸­çš„å†…å®¹
        System.out.println(referenceQueue.poll());
    }
}
```



##### 38.è™šå¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—

Javaæä¾›äº†4ç§å¼•ç”¨ç±»å‹ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œéƒ½æœ‰è‡ªå·±å„è‡ªçš„ç‰¹ç‚¹ã€‚

ReferenceQueueæ˜¯ç”¨æ¥é…åˆå¼•ç”¨å·¥ä½œçš„ï¼Œæ²¡æœ‰ReferenceQueueä¸€æ ·å¯ä»¥è¿è¡Œã€‚

åˆ›å»ºå¼•ç”¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šå…³è”çš„é˜Ÿåˆ—ï¼Œå½“Gcé‡Šæ”¾å¯¹è±¡å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å¼•ç”¨åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœ**ç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨è¿™ç›¸å½“äºæ˜¯ä¸€ç§é€šçŸ¥æœºåˆ¶**ã€‚

å½“å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ„å‘³ç€å¼•ç”¨æŒ‡å‘çš„å †å†…å­˜ä¸­çš„å¯¹è±¡è¢«å›æ”¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJVMå…è®¸æˆ‘ä»¬åœ¨å¯¹è±¡è¢«é”€æ¯åï¼Œåšä¸€äº›æˆ‘ä»¬è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚

##### 39.GCRootså’Œå››å¤§å¼•ç”¨å°æ€»ç»“

![img](images/cd9be030204769e861961629a9341191.png)

##### 40.JVMä¸­å¸¸è§çš„ä¸¤ç§é”™è¯¯

* StackoverFlowError
  * java.lang.StackOverflowError

* OutofMemoryError
  * java.lang.OutOfMemoryErrorï¼šjava heap space
  * java.lang.OutOfMemoryErrorï¼šGC overhead limit exceeeded
  * java.lang.OutOfMemoryErrorï¼šDirect buffer memory
  * java.lang.OutOfMemoryErrorï¼šunable to create new native thread
  * java.lang.OutOfMemoryErrorï¼šMetaspace

ä»¥ä¸‹æ˜¯Javaä¸­çš„é”™è¯¯å’Œå¼‚å¸¸çš„ç±»å›¾

![image-20211122171743664](images/image-20211122171743664.png)



##### 41.StackOverflowError

é”™è¯¯çš„å±•ç°:é€’å½’è°ƒç”¨ä¸€ä¸ªæ–¹æ³•è€Œæ²¡æœ‰è·³å‡ºã€‚æ ˆç©ºé—´ä¸€èˆ¬æ¯”è¾ƒå°ï¼Œé»˜è®¤æ˜¯512Kåˆ°1024Kä¹‹é—´ã€‚

```java
public class StackOverflowErrorDemo {
    public static void main(String[] args) {
        main(args);
    }
}
```

![image-20211122172019630](images/image-20211122172019630.png)



##### 42.OOMä¹‹Java heap space

å †å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå¯åŠ¨å‚æ•°è°ƒå°ç‚¹ï¼Œnewä¸€ä¸ªå¤§å¯¹è±¡å³å¯çœ‹åˆ°æ­¤é”™è¯¯

```java
public class OOMJavaHeapSpaceDemo {
    /**
     *
     * -Xms10m -Xmx10m
     *
     * @param args
     */
    public static void main(String[] args) {
        byte[] array = new byte[80 * 1024 * 1024];
    }
}
```



##### 43.OOMä¹‹GC overhead limit exceeded

è¶…å‡ºGCå¼€é”€é™åˆ¶

**GCå›æ”¶æ—¶é—´è¿‡é•¿**æ—¶ä¼šæŠ›å‡ºOutOfMemroyErrorã€‚è¿‡é•¿çš„å®šä¹‰æ˜¯ï¼Œè¶…è¿‡**98%**çš„æ—¶é—´ç”¨æ¥åšGCå¹¶ä¸”**å›æ”¶äº†ä¸åˆ°2%çš„å †å†…å­˜**ï¼Œ**è¿ç»­å¤šæ¬¡GC**éƒ½åªå›æ”¶äº†ä¸åˆ°2%çš„æç«¯æƒ…å†µä¸‹æ‰ä¼šæŠ›å‡ºã€‚

å‡å¦‚ä¸æŠ›å‡ºGC overhead limité”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿé‚£å°±æ˜¯GCæ¸…ç†çš„è¿™ä¹ˆç‚¹å†…å­˜å¾ˆå¿«ä¼šå†æ¬¡å¡«æ»¡ï¼Œè¿«ä½¿gcå†æ¬¡æ‰§è¡Œã€‚è¿™æ ·å°±å½¢æˆæ¶æ€§å¾ªç¯ï¼ŒCPUä½¿ç”¨ç‡ä¸€ç›´æ˜¯100%ï¼Œè€ŒGcå´æ²¡æœ‰ä»»ä½•æˆæœã€‚

![img](images/fc9fbf77d929b509b197f35139d7868d.png)

```java
/**
 *
 * -Xms10m -Xmx10m -XX:MaxDirectMemorySize=5m -XX:+PrintGCDetails
 *
 * @param args
 */
public static void main(String[] args) {
    int i = 0;
    List<String> list = new ArrayList<>();
    try {
        while(true) {
            list.add(String.valueOf(++i).intern());
        }
    } catch (Exception e) {
        System.out.println("***************i:" + i);
        e.printStackTrace();
        throw e;
    }
}
```

è¿è¡Œç»“æœï¼š
![image-20211122180904552](images/image-20211122180904552.png)



##### 44.OOMä¹‹Direct buffer memory

å¯¼è‡´åŸå› ï¼š

å†™NIOç¨‹åºç»å¸¸ä½¿ç”¨ByteBufferæ¥è¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºé€šé“(Channel)ä¸ç¼“å†²åŒº(Buffer)çš„IOæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †é‡Œé¢çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…”äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚

ByteBuffer.allocate(capability) ç¬¬ä¸€ç§æ–¹å¼æ˜¯**åˆ†é…JVMå †å†…å­˜**ï¼Œå±äºGCç®¡è¾–èŒƒå›´ï¼Œç”±äºéœ€è¦æ‹·è´æ‰€ä»¥é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚
ByteBuffer.allocateDirect(capability) ç¬¬äºŒç§æ–¹å¼æ˜¯**åˆ†é…OSæœ¬åœ°å†…å­˜**ï¼Œä¸å±äºGCç®¡è¾–èŒƒå›´ï¼Œç”±äºä¸éœ€è¦å†…å­˜æ‹·è´æ‰€ä»¥é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ã€‚
ä½†å¦‚æœä¸æ–­åˆ†é…æœ¬åœ°å†…å­˜ï¼Œå †å†…å­˜å¾ˆå°‘ä½¿ç”¨ï¼Œé‚£ä¹ˆJVå°±ä¸éœ€è¦æ‰§è¡ŒGCï¼ŒDirectByteBufferå¯¹è±¡ä»¬å°±ä¸ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å€™å †å†…å­˜å……è¶³ï¼Œä½†æœ¬åœ°å†…å­˜å¯èƒ½å·²ç»ä½¿ç”¨å…‰äº†ï¼Œå†æ¬¡å°è¯•åˆ†é…æœ¬åœ°å†…å­˜å°±ä¼šå‡ºç°OutOfMemoryErrorï¼Œé‚£ç¨‹åºå°±ç›´æ¥å´©æºƒäº†ã€‚

-XX:MaxDirectMemorySize=5m æ˜¯è®¾ç½®æœ¬åœ°ç›´æ¥å†…å­˜å¤§å°

```java
public class OOMEDirectBufferMemoryDemo {
    /**
     * -Xms5m -Xmx5m -XX:+PrintGCDetails -XX:MaxDirectMemorySize=5m
     *
     * @param args
     * @throws InterruptedException
     */
    public static void main(String[] args) throws InterruptedException {
        System.out.println(String.format("é…ç½®çš„maxDirectMemory: %.2f MB",//
                sun.misc.VM.maxDirectMemory() / 1024.0 / 1024));

        TimeUnit.SECONDS.sleep(3);

        ByteBuffer bb = ByteBuffer.allocateDirect(6 * 1024 * 1024);
    }
}
```

![image-20211122183149332](images/image-20211122183149332.png)



##### 45.OOMä¹‹unable to create new native thread

ä¸èƒ½å¤Ÿåˆ›å»ºæ›´å¤šçš„æ–°çš„çº¿ç¨‹äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ›å»ºçº¿ç¨‹çš„ä¸Šé™è¾¾åˆ°äº†

é«˜å¹¶å‘è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œç»å¸¸ä¼šå‡ºç°å¼‚å¸¸`java.lang.OutOfMemoryError:unable to create new native thread`ï¼Œå‡†ç¡®è¯´è¯¥native threadå¼‚å¸¸**ä¸å¯¹åº”çš„å¹³å°æœ‰å…³**

å¯¼è‡´åŸå› ï¼š

* åº”ç”¨åˆ›å»ºäº†å¤ªå¤šçº¿ç¨‹ï¼Œä¸€ä¸ªåº”ç”¨è¿›ç¨‹åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè¶…è¿‡ç³»ç»Ÿæ‰¿è½½æé™
* æœåŠ¡å™¨å¹¶ä¸å…è®¸ä½ çš„åº”ç”¨ç¨‹åºåˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œlinuxç³»ç»Ÿé»˜è®¤è¿è¡Œå•ä¸ªè¿›ç¨‹å¯ä»¥åˆ›å»ºçš„çº¿ç¨‹ä¸º1024ä¸ªï¼Œå¦‚æœåº”ç”¨åˆ›å»ºè¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œå°±ä¼šæŠ¥ java.lang.OutOfMemoryError:unable to create new native thread

è§£å†³æ–¹æ³•ï¼š

1. æƒ³åŠæ³•**é™ä½ä½ åº”ç”¨ç¨‹åºåˆ›å»ºçº¿ç¨‹çš„æ•°é‡**ï¼Œåˆ†æåº”ç”¨æ˜¯å¦çœŸçš„éœ€è¦åˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œæ”¹ä»£ç å°†çº¿ç¨‹æ•°é™åˆ°æœ€ä½
2. å¯¹äºæœ‰çš„åº”ç”¨ï¼Œç¡®å®éœ€è¦åˆ›å»ºå¾ˆå¤šçº¿ç¨‹ï¼Œè¿œè¶…è¿‡linuxç³»ç»Ÿé»˜è®¤**1024**ä¸ªçº¿ç¨‹é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹LinuxæœåŠ¡å™¨é…ç½®ï¼Œæ‰©å¤§linuxé»˜è®¤é™åˆ¶

ç¤ºä¾‹ï¼š

```java
public class OOMEUnableCreateNewThreadDemo {
    public static void main(String[] args) {
        for (int i = 0; ; i++) {
            System.out.println("************** i = " + i);
            new Thread(() -> {
                try {
                    TimeUnit.SECONDS.sleep(Integer.MAX_VALUE);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }, String.valueOf(i)).start();
        }
    }
}
```

ä¸Šé¢ç¨‹åºåœ¨Linux OSï¼ˆCentOSï¼‰è¿è¡Œï¼Œä¼šå‡ºç°ä¸‹åˆ—çš„é”™è¯¯ï¼Œçº¿ç¨‹æ•°å¤§æ¦‚åœ¨900å¤šä¸ª

```
Exception in thread "main" java.lang.OutOfMemoryError: unable to create new native thread
```

##### 46.OOMä¹‹unable to create new native threadä¸Šé™è°ƒæ•´

érootç”¨æˆ·ç™»å½•Linuxç³»ç»Ÿï¼ˆCentOSï¼‰æµ‹è¯•

æœåŠ¡å™¨çº§åˆ«è°ƒå‚è°ƒä¼˜

æŸ¥çœ‹ç³»ç»Ÿçº¿ç¨‹é™åˆ¶æ•°ç›®å‘½ä»¤

```c#
ulimit -u
```

ä¿®æ”¹ç³»ç»Ÿçº¿ç¨‹é™åˆ¶æ•°ç›®

```c
vim /etc/security/limits.d/90-nproc.conf 
```

æ‰“å¼€åå‘ç°é™¤äº†rootï¼Œå…¶ä»–è´¦æˆ·éƒ½é™åˆ¶åœ¨1024ä¸ª

![img](images/c27a569c9d4b5f2e46933711030866b1.png)

å‡å¦‚æˆ‘ä»¬æƒ³è¦å¼ ä¸‰è¿™ä¸ªç”¨å¢è¿è¡Œï¼Œå¸Œæœ›ä»–ç”Ÿæˆçš„çº¿ç¨‹å¤šä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹é…ç½®

![img](images/1ca76a04c6b892bc091b6f3887e613f6.png)

##### 47.OOMä¹‹Metaspace

ä½¿ç”¨java -XX:+PrintFlagsInitialå‘½ä»¤æŸ¥çœ‹æœ¬æœºçš„åˆå§‹åŒ–å‚æ•°ï¼Œ-XX:MetaspaceSizeä¸º21810376Bï¼ˆå¤§çº¦20.8Mï¼‰

**Java 8åŠä¹‹åçš„ç‰ˆæœ¬**ä½¿ç”¨Metaspaceæ¥æ›¿ä»£æ°¸ä¹…ä»£ã€‚

Metaspaceæ˜¯æ–¹æ³•åŒºåœ¨Hotspot ä¸­çš„å®ç°ï¼Œå®ƒä¸æŒä¹…ä»£æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š**Metaspaceå¹¶ä¸åœ¨è™šæ‹Ÿæœºå†…å­˜ä¸­è€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜**,ä¹Ÿå³åœ¨Java8ä¸­, classe metadata(the virtual machines internal presentation of Java class)ï¼Œè¢«å­˜å‚¨åœ¨å«åšMetaspace native memoryã€‚

æ°¸ä¹…ä»£ï¼ˆJava8åè¢«åŸç©ºå‘Metaspaceå–ä»£äº†ï¼‰å­˜æ”¾äº†ä»¥ä¸‹ä¿¡æ¯ï¼š

* è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯
* å¸¸é‡æ± 
* é™æ€å˜é‡
* å³æ—¶ç¼–è¯‘åçš„ä»£ç 

æ¨¡æ‹ŸMetaspaceç©ºé—´æº¢å‡ºï¼Œæˆ‘ä»¬å€ŸåŠ©CGLibç›´æ¥æ“ä½œå­—èŠ‚ç è¿è¡Œæ—¶ä¸æ–­ç”Ÿæˆç±»å¾€å…ƒç©ºé—´çŒï¼Œç±»å æ®çš„ç©ºé—´æ€»æ˜¯ä¼šè¶…è¿‡MetaspaceæŒ‡å®šçš„ç©ºé—´å¤§å°çš„ã€‚

é¦–å…ˆæ·»åŠ CGLibä¾èµ–

```xml
<dependency>    
    <groupId>cglib</groupId>    
    <artifactId>cglib</artifactId>    
    <version>3.2.10</version> 
</dependency>
```

å†æ˜¯ä»£ç ï¼š

```java
public class OOMEMetaspaceDemo {
    // é™æ€ç±»
    static class OOMObject {
    }

    /**
     * -XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=10m
     *
     * @param args
     */
    public static void main(final String[] args) {
        // æ¨¡æ‹Ÿè®¡æ•°å¤šå°‘æ¬¡ä»¥åå‘ç”Ÿå¼‚å¸¸
        int i = 0;
        try {
            while (true) {
                i++;
                // ä½¿ç”¨Springçš„åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯
                Enhancer enhancer = new Enhancer();
                enhancer.setSuperclass(OOMObject.class);
                enhancer.setUseCache(false);
                enhancer.setCallback(new MethodInterceptor() {
                    @Override
                    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
                        return methodProxy.invokeSuper(o, args);
                    }
                });
                enhancer.create();
            }
        } catch (Throwable e) {
            System.out.println("å‘ç”Ÿå¼‚å¸¸çš„æ¬¡æ•°:" + i);
            e.printStackTrace();
        } finally {

        }

    }
}
```

å‘ç”Ÿoomé”™è¯¯

![image-20211123181114789](images/image-20211123181114789.png)

